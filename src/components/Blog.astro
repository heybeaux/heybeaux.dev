---
// Blog section - Recent articles from content collection
import { getCollection } from 'astro:content';

// Get published posts, sorted by date
const allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

const posts = allPosts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3); // Show latest 3 on homepage

const hasPosts = posts.length > 0;

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
}
---

<section class="mb-16">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-sm font-mono text-[var(--color-accent)] uppercase tracking-wider">
      Writing
    </h2>
    {hasPosts && (
      <a href="/blog" class="text-sm font-mono text-[var(--color-muted)] hover:text-[var(--color-accent)]">
        View all â†’
      </a>
    )}
  </div>
  
  {hasPosts ? (
    <div class="grid gap-4">
      {posts.map((post) => (
        <a href={`/blog/${post.slug}`} class="card p-6 group block">
          <div class="flex flex-wrap items-baseline justify-between gap-2 mb-2">
            <h3 class="text-lg font-semibold group-hover:text-[var(--color-accent)] transition-colors">
              {post.data.title}
            </h3>
            <span class="text-sm text-[var(--color-muted)] font-mono">
              {formatDate(post.data.date)}
            </span>
          </div>
          <p class="text-[var(--color-muted)]">
            {post.data.excerpt}
          </p>
          {post.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2 mt-3">
              {post.data.tags.map((tag) => (
                <span class="text-xs font-mono text-[var(--color-muted)] bg-[var(--color-bg)] px-2 py-1 rounded border border-[var(--color-border)]">
                  #{tag}
                </span>
              ))}
            </div>
          )}
        </a>
      ))}
    </div>
  ) : (
    <div class="card p-6 text-center">
      <p class="text-[var(--color-muted)] mb-2">
        Writing about building things, breaking things, and occasionally fixing them.
      </p>
      <p class="text-sm font-mono text-[var(--color-muted)]">
        First posts coming soon.
      </p>
    </div>
  )}
</section>

<div class="section-divider"></div>
